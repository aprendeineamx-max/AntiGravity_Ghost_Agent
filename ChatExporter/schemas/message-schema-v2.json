{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://antigravity.local/schemas/chat-export-v2.json",
    "title": "AntiGravity Chat Export",
    "description": "Schema for AntiGravity chat conversation exports",
    "type": "object",
    "required": [
        "version",
        "exported_at",
        "metadata",
        "messages"
    ],
    "properties": {
        "version": {
            "type": "string",
            "description": "Schema version",
            "const": "2.0"
        },
        "exported_at": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 timestamp of export"
        },
        "source": {
            "type": "string",
            "description": "Export source tool",
            "default": "AntiGravity Chat Exporter"
        },
        "metadata": {
            "type": "object",
            "required": [
                "total_messages"
            ],
            "properties": {
                "total_messages": {
                    "type": "integer",
                    "minimum": 0
                },
                "participants": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "enum": [
                            "user",
                            "agent",
                            "system"
                        ]
                    },
                    "uniqueItems": true
                },
                "has_images": {
                    "type": "boolean",
                    "default": false
                },
                "has_code": {
                    "type": "boolean",
                    "default": false
                },
                "duration_minutes": {
                    "type": "number",
                    "minimum": 0
                },
                "start_time": {
                    "type": "string",
                    "format": "date-time"
                },
                "end_time": {
                    "type": "string",
                    "format": "date-time"
                }
            }
        },
        "messages": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/message"
            },
            "minItems": 0
        }
    },
    "definitions": {
        "message": {
            "type": "object",
            "required": [
                "id",
                "from",
                "content"
            ],
            "properties": {
                "id": {
                    "type": "string",
                    "pattern": "^msg_\\d{3,}$",
                    "description": "Unique message ID (e.g., msg_001)"
                },
                "timestamp": {
                    "type": "string",
                    "description": "Message timestamp (ISO 8601 or HH:MM:SS)",
                    "default": "Unknown"
                },
                "from": {
                    "type": "string",
                    "enum": [
                        "user",
                        "agent",
                        "system"
                    ],
                    "description": "Message sender"
                },
                "type": {
                    "type": "string",
                    "enum": [
                        "text",
                        "code",
                        "text+code",
                        "text+image",
                        "error",
                        "system"
                    ],
                    "default": "text"
                },
                "content": {
                    "type": "object",
                    "required": [
                        "text"
                    ],
                    "properties": {
                        "text": {
                            "type": "string",
                            "description": "Plain text content"
                        },
                        "markdown": {
                            "type": "string",
                            "description": "Full markdown representation"
                        },
                        "code_blocks": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/code_block"
                            }
                        }
                    }
                },
                "attachments": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/attachment"
                    }
                },
                "metadata": {
                    "type": "object",
                    "properties": {
                        "char_count": {
                            "type": "integer",
                            "minimum": 0
                        },
                        "line_count": {
                            "type": "integer",
                            "minimum": 0
                        },
                        "has_code": {
                            "type": "boolean"
                        },
                        "code_language": {
                            "type": "string"
                        }
                    }
                },
                "relationships": {
                    "type": "object",
                    "properties": {
                        "reply_to": {
                            "type": "string",
                            "pattern": "^msg_\\d{3,}$"
                        },
                        "continuation_of": {
                            "type": "string",
                            "pattern": "^msg_\\d{3,}$"
                        }
                    }
                }
            }
        },
        "code_block": {
            "type": "object",
            "required": [
                "code"
            ],
            "properties": {
                "language": {
                    "type": "string",
                    "description": "Programming language",
                    "examples": [
                        "powershell",
                        "javascript",
                        "python",
                        "bash"
                    ]
                },
                "code": {
                    "type": "string",
                    "description": "Code content"
                },
                "line_numbers": {
                    "type": "boolean",
                    "default": false
                }
            }
        },
        "attachment": {
            "type": "object",
            "required": [
                "type",
                "filename"
            ],
            "properties": {
                "type": {
                    "type": "string",
                    "enum": [
                        "image",
                        "file",
                        "link"
                    ]
                },
                "filename": {
                    "type": "string"
                },
                "path": {
                    "type": "string",
                    "description": "Relative path to file"
                },
                "size_bytes": {
                    "type": "integer",
                    "minimum": 0
                },
                "url": {
                    "type": "string",
                    "format": "uri"
                }
            }
        }
    }
}